box: wercker/rvm
services:
  - wercker/postgresql9.2
build:
  steps:
    - bundle-install
    - script:
      name: echo ruby information
      code: |
          echo "ruby version $(ruby --version) running"
          echo "from location $(which ruby)"
          echo -p "gem list: $(gem list)"
    - rails-database-yml:
      service: postgresql
    - script:
      name: Set up db
      code: RAILS_ENV=test bundle exec rake db:schema:load
    - script:
      name: rspec
      code: bundle exec rspec

deploy:
  steps:
    - heroku-deploy
    - script:
      name: update database
      code: heroku run rake db:migrate --app $TARGET_NAME
